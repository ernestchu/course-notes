import{_ as s,c as n,o as a,b as l}from"./app.eea76462.js";const o="/course-notes/assets/figure-1.183873f6.png",p="/course-notes/assets/figure-2.e0ca2cf6.png",u=JSON.parse('{"title":"UNIX Socket Programming","description":"","frontmatter":{},"headers":[{"level":2,"title":"Preliminary","slug":"preliminary","link":"#preliminary","children":[{"level":3,"title":"Transportation-layer protocols","slug":"transportation-layer-protocols","link":"#transportation-layer-protocols","children":[]},{"level":3,"title":"Port","slug":"port","link":"#port","children":[]},{"level":3,"title":"IP address","slug":"ip-address","link":"#ip-address","children":[]}]},{"level":2,"title":"Basic Socket I/O","slug":"basic-socket-i-o","link":"#basic-socket-i-o","children":[{"level":3,"title":"TCP server","slug":"tcp-server","link":"#tcp-server","children":[]},{"level":3,"title":"TCP client","slug":"tcp-client","link":"#tcp-client","children":[]},{"level":3,"title":"UDP server","slug":"udp-server","link":"#udp-server","children":[]},{"level":3,"title":"UDP client","slug":"udp-client","link":"#udp-client","children":[]}]},{"level":2,"title":"Advanced Socket I/O","slug":"advanced-socket-i-o","link":"#advanced-socket-i-o","children":[{"level":3,"title":"Simultaneous UDP server","slug":"simultaneous-udp-server","link":"#simultaneous-udp-server","children":[]}]}],"relativePath":"courses/cse491-network-application-programming/chapter-3.md"}'),e={name:"courses/cse491-network-application-programming/chapter-3.md"},t=l(`<h1 id="unix-socket-programming" tabindex="-1">UNIX Socket Programming <a class="header-anchor" href="#unix-socket-programming" aria-hidden="true">#</a></h1><h2 id="preliminary" tabindex="-1">Preliminary <a class="header-anchor" href="#preliminary" aria-hidden="true">#</a></h2><p>Server and client exchange messages over network through a common <a href="./chapter-2.html#internet-socket">socket API</a></p><h3 id="transportation-layer-protocols" tabindex="-1">Transportation-layer protocols <a class="header-anchor" href="#transportation-layer-protocols" aria-hidden="true">#</a></h3><h4 id="udp" tabindex="-1">UDP <a class="header-anchor" href="#udp" aria-hidden="true">#</a></h4><ul><li>Single socket to receive messages</li><li>No guarantee of delivery</li><li>Not necessarily in-order delivery</li><li><strong>Datagram</strong><ul><li>Independent packets</li></ul></li><li>Must address each packet</li><li>Examples <ul><li>Multimedia</li><li>VoIP</li></ul></li></ul><h4 id="tcp" tabindex="-1">TCP <a class="header-anchor" href="#tcp" aria-hidden="true">#</a></h4><ul><li>Connection-oriented, dedicated socket for each connection</li><li>Reliable, ensuring delivery</li><li>Byte <strong>stream</strong>, in-order delivery</li><li>Setup connection before data transfer</li><li>Examples <ul><li>Web</li><li>email</li><li>ssh</li></ul></li></ul><h3 id="port" tabindex="-1">Port <a class="header-anchor" href="#port" aria-hidden="true">#</a></h3><p>A host can have up to 2<sup>16</sup> ports and they&#39;re used by different processes on the host. The port numbers are used to identify entities (processes) on a host. Port numbers can be</p><ol><li>Well-known (ports 0 ~ 1023)</li><li>Registered (ports 1024 ~ 49151) <ul><li>can be used by ordinary users</li></ul></li><li>Dynamic, private, or ephemeral (ports 49152 ~ 65535)</li></ol><ul><li><strong>Servers</strong> and <strong>daemons</strong> (medium between applications and the kernel) usually use well-known ports <ul><li>https: 443</li><li>ssh: 22</li></ul></li><li>Client usually use dynamic ports <ul><li>Assigned by the kernel at run time</li></ul></li></ul><h3 id="ip-address" tabindex="-1">IP address <a class="header-anchor" href="#ip-address" aria-hidden="true">#</a></h3><p>Each attachment point on the Internet is assigned with a unique <strong>address</strong>. However, it hard for human to memorize the numeric addresses. Instead, we prefer to deal with names, hence the domain name server (DNS) provides the mapping of host names to their IP address.</p><h4 id="ipv4-internet-addressing" tabindex="-1">IPv4 Internet addressing <a class="header-anchor" href="#ipv4-internet-addressing" aria-hidden="true">#</a></h4><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#89DDFF;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">netinet/in.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* Internet address structure */</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> in_addr </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">in_addr_t</span><span style="color:#F07178;"> s_addr</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">                   /* 32-bit IPv4 address */</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* Socket address */</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">u_char</span><span style="color:#F07178;">          sin_len</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">            /* length (16, optional) */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">u_short</span><span style="color:#F07178;">         sin_family</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">         /* address family (AF_INET) &lt;- v4 */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">u_short</span><span style="color:#F07178;">         sin_port</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">           /* UDP or TCP port */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> in_addr  sin_addr</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">           /* IP address */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">char</span><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">sin_zero</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">];</span><span style="color:#676E95;">        /* unused (padding) */</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="ipv6-internet-addressing" tabindex="-1">IPv6 Internet addressing <a class="header-anchor" href="#ipv6-internet-addressing" aria-hidden="true">#</a></h4><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#89DDFF;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">netinet/in.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* Internet address structure */</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> in6_addr </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">uint8_t</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">s6_addr</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">16</span><span style="color:#89DDFF;">];</span><span style="color:#676E95;">                /* 128-bit IPv6 address */</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">#define</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SIN6_LEN</span><span style="color:#676E95;">                       /* required for compile-time tests */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* Socket address */</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in6 </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">sa_family_t</span><span style="color:#F07178;">     sin6_family</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">        /* AF_INET6 &lt;- v4 */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">in_port_t</span><span style="color:#F07178;">       sin6_port</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">          /* transport layer port num */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">uint32_t</span><span style="color:#F07178;">        sin6_flowinfo</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">      /* IPv6 flow information */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">struct</span><span style="color:#F07178;"> in6_addr sin6_addr</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">          /* IPv6 address */</span></span>
<span class="line"><span style="color:#676E95;">    /* set of interfaces for a scope */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">uint32_t</span><span style="color:#F07178;">        sin6_scope_id</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="byte-ordering" tabindex="-1">Byte ordering <a class="header-anchor" href="#byte-ordering" aria-hidden="true">#</a></h4><p>The endianess (big/little) may be different between hosts, so we should use a byte-ordering translation procedure to maintain the compatibility.</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#89DDFF;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">netinet/in.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#C792EA;">uint32_t</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">htonl</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">uint32_t</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">hostlong</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#C792EA;">uint16_t</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">htons</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">uint16_t</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">hostshort</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#C792EA;">uint32_t</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ntohl</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">uint32_t</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">netlong</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#C792EA;">uint16_t</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ntohs</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">uint16_t</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">netshort</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><ul><li><strong>h</strong>: host byte order</li><li><strong>n</strong>: network (remote) byte order</li><li><strong>l</strong>: long (4 bytes), used to convert IP addresses</li><li><strong>s</strong>: short (2 bytes), used to convert port numbers</li></ul><h4 id="unix-data-types" tabindex="-1">UNIX data types <a class="header-anchor" href="#unix-data-types" aria-hidden="true">#</a></h4><table><tr><th>Datatype</th><th>Description</th><th>Header</th></tr><tr><td>int8_t</td><td>Unsigned 8-bit integer</td><td rowspan="6">&lt;sys/types.h&gt;</td></tr><tr><td>uint8_t</td><td>Signed 16-bit integer</td></tr><tr><td>int16_t</td><td>Signed 16-bit integer</td></tr><tr><td>uint16_t</td><td>Unsigned 16-bit integer</td></tr><tr><td>int32_t</td><td>Signed 32-bit integer</td></tr><tr><td>uint32_t</td><td>Unsigned 32-bit integer</td></tr><tr><td>sa_family_t</td><td>Address family of socket address structure</td><td rowspan="2">&lt;sys/socket.h&gt;</td></tr><tr><td>socklen_t</td><td>Length of socket address structure, normally uint32_t</td></tr><tr><td>in_addr_t</td><td>IPv4 address, normally uint32_t</td><td rowspan="2">&lt;netinet/in.h&gt;</td></tr><tr><td>in_port_t</td><td>TCP or UDP port, normally uint16_t</td></tr></table><h2 id="basic-socket-i-o" tabindex="-1">Basic Socket I/O <a class="header-anchor" href="#basic-socket-i-o" aria-hidden="true">#</a></h2><p>Socket is a <strong>file descriptor</strong> which allows an application to read/write data from/to the network.</p><div class="tip custom-block"><p class="custom-block-title">File Descriptor</p><p>In Unix, all of the I/O are treated as files stream, where <code>stdin</code>, <code>stdout</code> and <code>stderr</code> are mapped to <code>0</code>, <code>1</code> and <code>2</code> in the file descriptor table respectively.</p></div><h3 id="tcp-server" tabindex="-1">TCP server <a class="header-anchor" href="#tcp-server" aria-hidden="true">#</a></h3><p>TCP establishes connection before each host can transmit data. We require a serial of procedures to build up a TCP server</p><ol><li><a href="#socket-procedure">socket()</a>: Get the <strong>file descriptor</strong>.</li><li><a href="#bind-procedure">bind()</a>: Connect the file descriptor with <strong>IP</strong> and <strong>port</strong>.</li><li><a href="#listen-procedure">listen()</a>: <strong>Wait</strong> for request from clients.</li><li><a href="#accept-procedure">accept()</a>: <strong>Accept</strong> request.</li><li><a href="#read-procedure">read()</a>: Read data from the socket.</li></ol><h4 id="socket-procedure" tabindex="-1">socket procedure <a class="header-anchor" href="#socket-procedure" aria-hidden="true">#</a></h4><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#89DDFF;">#include</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">sys/socket.h</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">socket</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">family</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">protocol</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span></code></pre></div><ul><li><code>socket()</code> returns the file descriptor <ul><li>A negative value indicates an error</li></ul></li><li><code>family</code><ul><li><code>AF_INET</code> for IPv4</li><li><code>AF_INET6</code> for IPv6</li></ul></li><li><code>type</code><ul><li><code>SOCK_STREAM</code>, typically TCP</li><li><code>SOCK_DGRAMm</code> typically UDP</li></ul></li><li><code>protocol</code>, if not compatible with <code>type</code>, then default to TCP or UDP based on <code>type</code><ul><li><code>IPPROTO_TCP</code></li><li><code>IPPROTO_UDP</code></li><li>...</li></ul></li></ul><h4 id="bind-procedure" tabindex="-1">bind procedure <a class="header-anchor" href="#bind-procedure" aria-hidden="true">#</a></h4><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> fd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in srv</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* 1) create the socket by socket() */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_family      </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> AF_INET</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">              /* IPv4*/</span></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_port        </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">htons</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;">            /* listen on port 80 */</span></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_addr.s_addr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">htonl</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">INADDR_ANY</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;">    /* listen on all of the network interface */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">bind</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr</span><span style="color:#89DDFF;">*)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">srv</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#A6ACCD;">srv</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bind</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="listen-procedure" tabindex="-1">listen procedure <a class="header-anchor" href="#listen-procedure" aria-hidden="true">#</a></h4><p>When a socket is created by <code>socket()</code>, it default to a <strong>active</strong> socket. Then <code>listen()</code> procedure converts it to a <strong>passive</strong> socket, so kernel can accept incoming connection directed to this socket.</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#89DDFF;">#define</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BACKLOG</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span><span style="color:#676E95;">     /* This specifies the max #connections that kernel should queue for this socket */</span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> fd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in srv</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* 1) create the socket by socket() */</span></span>
<span class="line"><span style="color:#676E95;">/* 2) bind the socket to a port by bind() */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">listen</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> BACKLOG</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">listen</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>Here the connection is not established yet! We just store the requests in a queue. The size of the queue depends on <code>BACKLOG</code></p><div class="danger custom-block"><p class="custom-block-title">Backlog of Zero</p><p>If you do not want any client to connect to your socket, just <strong>close</strong> the socket. The backlog is a <strong>pseudo</strong> size. A backlog of zero do not set the number of queued connections to zero.</p></div><h4 id="accept-procedure" tabindex="-1">accept procedure <a class="header-anchor" href="#accept-procedure" aria-hidden="true">#</a></h4><p><code>accept()</code> blocks waiting for a connection, and if there&#39;s request, a connection is established. It returns a <strong>new socket</strong> (newfd, dedicated socket for the connection).</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> fd</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">                     /* used by socket() */</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in srv</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">     /* used by bind() */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in cli</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">     /* used by accept() */</span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> newfd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> cli_len </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#A6ACCD;">cli</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* 1) create the socket by socket() */</span></span>
<span class="line"><span style="color:#676E95;">/* 2) bind the socket to a port by bind() */</span></span>
<span class="line"><span style="color:#676E95;">/* 3) listen on the socket */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">newfd </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">accept</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr</span><span style="color:#89DDFF;">*)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">cli</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">cli_len</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#676E95;">/* The client may be IPv4 or IPv6, pass the references of client variables */</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">newfd </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">accept</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><ul><li>Get the information of the client <ul><li><code>cli.sin_addr.s_addr</code> contains client&#39;s IP address</li><li><code>cli.sin_port</code> contains client&#39;s port number</li><li>Use <a href="#numerical-address-to-string">this</a> to extract the content.</li></ul></li><li>Then, the server can exchange data with the client by using <code>read()</code> and <code>write()</code> on the file descriptor <code>newfd</code></li></ul><h4 id="read-procedure" tabindex="-1">read procedure <a class="header-anchor" href="#read-procedure" aria-hidden="true">#</a></h4><ul><li><code>read()</code> can be used to get data from a socket <ul><li><code>read()</code> blocks waiting for data from the client</li><li>It does <strong>not</strong> guarantee that a <code>sizeof(buf)</code> amount of data will be read</li><li>It returns #bytes transmitted</li></ul></li></ul><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#89DDFF;">#define</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BUFSIZE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">512</span></span>
<span class="line"><span style="color:#A6ACCD;">inf newfd</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">             /* dedicated fd */</span></span>
<span class="line"><span style="color:#C792EA;">char</span><span style="color:#A6ACCD;"> buf</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">BUFSIZE</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> nbytes</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* 1) create the socket by socket() */</span></span>
<span class="line"><span style="color:#676E95;">/* 2) bind the socket to a port by bind() */</span></span>
<span class="line"><span style="color:#676E95;">/* 3) listen on the socket */</span></span>
<span class="line"><span style="color:#676E95;">/* 4) accept the incoming connection */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">nbytes </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">read</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">newfd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> buf</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#A6ACCD;">buf</span><span style="color:#89DDFF;">)))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">read</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="tcp-client" tabindex="-1">TCP client <a class="header-anchor" href="#tcp-client" aria-hidden="true">#</a></h3><h4 id="deal-with-ip-address" tabindex="-1">Deal with IP address <a class="header-anchor" href="#deal-with-ip-address" aria-hidden="true">#</a></h4><p>TCP client needs to know the IP address of the server. However, we use IP addresses as <strong>strings</strong> (with dot, right?) Meanwhile, The computers only recognize them as numbers. So we need a <strong>conversion procedure</strong> again.</p><h5 id="string-to-numerical-address" tabindex="-1">String to numerical address <a class="header-anchor" href="#string-to-numerical-address" aria-hidden="true">#</a></h5><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in srv</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_addr.s_addr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">inet_addr</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">140.117.11.87</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">srv.sin_addr.s_addr </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">in_addr_t</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">fprintf</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">stderr</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">inet_addr failed!</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h5 id="numerical-address-to-string" tabindex="-1">Numerical address to string <a class="header-anchor" href="#numerical-address-to-string" aria-hidden="true">#</a></h5><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in srv</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">char</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">t </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">inet_ntoa</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">srv.sin_addr</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">t </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">fprintf</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">stderr</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">inet_ntoa failed!</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="connect-procedure" tabindex="-1">connect procedure <a class="header-anchor" href="#connect-procedure" aria-hidden="true">#</a></h4><p><code>connect()</code> allows a client to connect with the server.</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> fd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in srv</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* 1) create the socket by socket() */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_family      </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> AF_INET</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_port        </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">htons</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">80</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_addr.s_addr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">inet_addr</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">140.117.11.87</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;"> /* specify the server IP */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">connect</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr</span><span style="color:#89DDFF;">*)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">srv</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#A6ACCD;">srv</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">connect</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="write-procedure" tabindex="-1">write procedure <a class="header-anchor" href="#write-procedure" aria-hidden="true">#</a></h4><p><code>write()</code> can be used to write data to a socket</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#89DDFF;">#define</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BUFSIZE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">512</span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> fd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in srv</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">char</span><span style="color:#A6ACCD;"> buf</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">BUFSIZE</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> nbytes</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* 1) create the socket by socket() */</span></span>
<span class="line"><span style="color:#676E95;">/* 2) connect() to the server */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">nbytes </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> buf</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#A6ACCD;">buf</span><span style="color:#89DDFF;">)))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">write</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="tcp-client-server-interaction" tabindex="-1">TCP client-server interaction <a class="header-anchor" href="#tcp-client-server-interaction" aria-hidden="true">#</a></h4><p><img src="`+o+`" alt="figure-1"></p><blockquote><p>Image credit to Professor Wang&#39;s slides</p></blockquote><h3 id="udp-server" tabindex="-1">UDP server <a class="header-anchor" href="#udp-server" aria-hidden="true">#</a></h3><p>UDP uses a single socket for all the transmission We require a three procedures to build up a UDP server</p><ol><li><a href="#socket-procedure-2">socket()</a>: Get the <strong>file descriptor</strong>.</li><li><a href="#bind-procedure-2">bind()</a>: Connect the file descriptor with <strong>IP</strong> and <strong>port</strong>.</li><li><a href="#recvfrom-procedure">recvfrom()</a>: Receive data from the socket</li></ol><h4 id="socket-procedure-1" tabindex="-1">socket procedure <a class="header-anchor" href="#socket-procedure-1" aria-hidden="true">#</a></h4><p>UDP server must create a <strong>datagram</strong> socket</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> fd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">((</span><span style="color:#A6ACCD;">fd </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">socket</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">AF_INET</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> SOCK_DGRAM</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;">    /* we didn&#39;t specify the protocol, becuase SOCK_DGRAM default it to UDP */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">socket</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">eixt</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="bind-procedure-1" tabindex="-1">bind procedure <a class="header-anchor" href="#bind-procedure-1" aria-hidden="true">#</a></h4><p>A socket can be bound to a port</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> fd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in srv</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* 1) create the socket by socket() */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_family      </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> AF_INET</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_port        </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">htons</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">123</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_addr.s_addr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">htonl</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">INADDR_ANY</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">bind</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr</span><span style="color:#89DDFF;">*)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">srv</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#A6ACCD;">srv</span><span style="color:#89DDFF;">))</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">bind</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="recvfrom-procedure" tabindex="-1">recvfrom procedure <a class="header-anchor" href="#recvfrom-procedure" aria-hidden="true">#</a></h4><p><code>read</code> does not provide client&#39;s addres to UDP server, but in UDP, every transmission need to specify the IP.</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> fd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in srv</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in cli</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">char</span><span style="color:#A6ACCD;"> buf</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">512</span><span style="color:#89DDFF;">];</span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> cli_len </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#A6ACCD;">cli</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> nbytes</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* 1) create the socket by socket() */</span></span>
<span class="line"><span style="color:#676E95;">/* 2) bind to the socket by bind() */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">nbyts </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">recvfrom</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> buf</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#A6ACCD;">buf</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr</span><span style="color:#89DDFF;">*)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">cli</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">cli_len</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">nbytes </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">recvfrom</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>Actoins performed by recvfrom() procedure</p><ol><li>Return the #bytes read, i.e., <code>nbytes</code>.</li><li>Copy a <code>nbytes</code> amount of data into <code>buf</code>.</li><li>Modified the address of the client, i.e., <code>cli</code>.</li><li>Modified the length of the client, i.e., <code>cli_len</code>.</li></ol><h3 id="udp-client" tabindex="-1">UDP client <a class="header-anchor" href="#udp-client" aria-hidden="true">#</a></h3><ol><li>socket(): Get the <strong>file descriptor</strong>.</li><li>sendto(): Send data to the socket</li></ol><h4 id="sendto-procedure" tabindex="-1">sendto procedure <a class="header-anchor" href="#sendto-procedure" aria-hidden="true">#</a></h4><p>UDP client does not bind a port number. A port number is dynamically assigned when the first <code>sendto()</code> procedure is invoked.</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> fd</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr_in srv</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_family      </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> AF_INET</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_port        </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">htons</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">123</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">srv.sin_addr.s_addr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">inet_addr</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">140.117.11.87</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">nbytes </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sendto</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> buf</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#A6ACCD;">buf</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sockaddr</span><span style="color:#89DDFF;">*)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#A6ACCD;">srv</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#A6ACCD;">srv</span><span style="color:#89DDFF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">nbytes </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sendto</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="udp-client-server-interaction" tabindex="-1">UDP client-server interaction <a class="header-anchor" href="#udp-client-server-interaction" aria-hidden="true">#</a></h4><p><img src="`+p+`" alt="figure-2"></p><blockquote><p>Image credit to Professor Wang&#39;s slides</p></blockquote><h2 id="advanced-socket-i-o" tabindex="-1">Advanced Socket I/O <a class="header-anchor" href="#advanced-socket-i-o" aria-hidden="true">#</a></h2><h3 id="simultaneous-udp-server" tabindex="-1">Simultaneous UDP server <a class="header-anchor" href="#simultaneous-udp-server" aria-hidden="true">#</a></h3><h4 id="a-naive-solution" tabindex="-1">A naive solution <a class="header-anchor" href="#a-naive-solution" aria-hidden="true">#</a></h4><p>What&#39;s wrong with the following code</p><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> s1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> s2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">/* create socket for s1, s2 and bind to ports */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">recvfrom</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">s1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> buf1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#F07178;">buf</span><span style="color:#89DDFF;">),</span><span style="color:#F07178;"> ...</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">recvfrom</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">s2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> buf2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#F07178;">buf2</span><span style="color:#89DDFF;">),</span><span style="color:#F07178;"> ...</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">Answer</p><p>If client <code>s1</code> never send data, the server would blocking wait for <code>s1</code> and would never have chance to receive data from <code>s2</code>.</p></div><h4 id="select-procedure" tabindex="-1">select procedure <a class="header-anchor" href="#select-procedure" aria-hidden="true">#</a></h4><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">select</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">maxfds</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    fdset </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">readfds</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    fd_set </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">writefds</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    fd_set </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">exceptfds</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> timeval </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">timeout</span></span>
<span class="line"><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">FD_CLR</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> fd_set </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">fds</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;">  /* clear the bit for fd in fds */</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#82AAFF;">FD_ISSET</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> fd_set </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">fds</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;">  /* is the bit for fd in fds? */</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#82AAFF;">FD_SET</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">fd</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> fd_set </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">fds</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;">  /* turn on the bit for fd in fds */</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#82AAFF;">FD_ZERO</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">fd_set </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">fds</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;">          /* clear all bits in fds */</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span></code></pre></div><ul><li><code>maxfds</code>: Number of descriptors to be tested <ul><li>fd (0, 1, ..., <code>maxfds-1</code>) will be tested.</li></ul></li><li><code>readfds</code>: Return a set of fds that are ready to read</li><li><code>writefds</code>: Return a set of fds that are ready to write</li><li><code>exceptfds</code>: Return a set of fds with exception conditions</li><li><code>timeout</code>: <ul><li>If it&#39;s NULL, then wait forever and return only when one of the fd is ready for I/O</li><li>Otherwise, wait up to <code>timeout</code></li><li>Or we can just specify it to 0 in a <strong>while loop</strong></li></ul></li></ul><div class="language-c"><button class="copy"></button><span class="lang">c</span><pre><code><span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> s1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> s2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">fd_set readfds</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">FD_ZERO</span><span style="color:#89DDFF;">(&amp;</span><span style="color:#F07178;">readfds</span><span style="color:#89DDFF;">)</span><span style="color:#676E95;">       /* initialize the fd set */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">FD_SET</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">s1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">readfds</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;">   /* add s1 to the fd set */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">FD_SET</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">s2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">readfds</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;">   /* add s2 to the fd set */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;">    /* use select() for synchronous I/O multiplexing */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">select</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">s2</span><span style="color:#89DDFF;">+</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">readfds</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;">        /* notice for s2 + 1 */</span></span>
<span class="line"><span style="color:#676E95;">        /* set one of the fd in (0, 1, ... s2) */</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">perror</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">select</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">FD_ISSET</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">s1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">readfds</span><span style="color:#89DDFF;">))</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">recvfrom</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">s1</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> buf</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#F07178;">buf</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">FD_ISSET</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">s2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;</span><span style="color:#F07178;">readfds</span><span style="color:#89DDFF;">))</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">recvfrom</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">s2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> buf</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">sizeof(</span><span style="color:#F07178;">buf</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div>`,95),r=[t];function c(i,D,y,F,d,A){return a(),n("div",null,r)}const h=s(e,[["render",c]]);export{u as __pageData,h as default};
